*******************************************************************************
*                                                                             *
*                           WINDROSE (DATED 90180)                            *
*                                                                             *
*              *** SEE WINDROSE MODEL CHANGE BULLETIN MCB#1 ***               *
*                                                                             *
*       ON THE SUPPORT CENTER FOR REGULATORY AIR MODELS BULLETIN BOARD        *
*                                                                             *
*                             919-541-5742                                    *
*******************************************************************************
      PROGRAM MAIN
      DIMENSION IDIRL(37),IOB(37,6),WSCUL(6)
      DIMENSION FIL(7),IFIL(7),ITITLE(7)
      CHARACTER*3 MONL(12)
      DATA MONL/'JAN','FEB','MAR','APR','MAY','JUN','JUL',
     *'AUG','SEP','OCT','NOV','DEC'/
      DATA IDIRL/0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,
     *19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36/
      NREC=0
      IRPT=1
      ICLM=0
      READ(5,2)ITITLE
      READ(5,1) ISTA,IYR,IBMO,IEMO,NWSCT
1     FORMAT(I5,4I2)
2     FORMAT(20A4)
      IF((NWSCT .LT. 1) .OR. (NWSCT .GT. 6))GOTO 807
      READ(5,3)(WSCUL(J),J=1,5)
    3 FORMAT(5F5.0)
      WSCUL(NWSCT)=WSCUL(NWSCT-1)
      WSL=WSCUL(1)
      READ(7,4)ISSI,JYR,IMO,IDIR,IIWS
    4 FORMAT(I5,2I2,29X,2I2)
      AWS=IIWS*0.51444
      IF(ISSI.NE.ISTA) GO TO 801
      IF(IYR.NE.JYR)GO TO 802
      GOTO32
   31 READ(7,4,END=300)ISSI,JYR,IMO,IDIR,IIWS
      AWS=IIWS*0.51444
   32 IF(IMO.LT.IBMO) GO TO 31
      IF(IMO.GT.IEMO) GO TO 300
      NREC=NREC+1
      IF(NWSCT.EQ.1) IWS=1
      IF(NWSCT.EQ.1) GO TO 79
      DO 70 I=1,NWSCT-1
      IWS=I
      IF(WSCUL(I).GT.AWS) GO TO 79
   70 CONTINUE
      IWS=NWSCT
   79 IF (IIWS.EQ.0.AND.IDIR.EQ.0)GOTO 80
      IF(IIWS.EQ.0.AND.IDIR.GT.0)goto803
      if(IIWS.GT.0.AND.IDIR.EQ.0)goto803
      GOTO81
   80 ICLM = ICLM + 1
      GO TO 147
   81 CONTINUE
      DO 90 I=1,37
      IF(IDIR.EQ.IDIRL(I))GOTO100
   90 CONTINUE
  100 CONTINUE
      IOB(I,IWS)=IOB(I,IWS)+1
  147 IOBTOT=IOBTOT+1
  150 CONTINUE
      GO TO 31
  300 WRITE(6,301) ISTA,ITITLE
  301 FORMAT(1H1,'STATION NUMBER: ',1X,I5,2X,20A4)
      WRITE(6,302) IYR
  302 FORMAT(1X,'YEAR  19',I2,//)
       WRITE(6,303) MONL(IBMO),MONL(IEMO)
  303 FORMAT(54X,'FREQUENCY DISTRIBUTION (',A3,'-',A3,')'//)
      NN=NWSCT-1
      IF(NWSCT.EQ.1) WRITE(6,310)
      IF(NWSCT.EQ.2) WRITE(6,311) WSL,(WSCUL(J),J=2,NN),
     *WSCUL(NWSCT)
      IF(NWSCT.EQ.3) WRITE(6,312) WSL,(WSCUL(J),J=2,NN),
     *WSCUL(NWSCT)
      IF(NWSCT.EQ.4) WRITE(6,313) WSL,(WSCUL(J),J=2,NN),
     *WSCUL(NWSCT)
      IF(NWSCT.EQ.5) WRITE(6,314) WSL,(WSCUL(J),J=2,NN),
     *WSCUL(NWSCT)
      IF(NWSCT.EQ.6) WRITE(6,315) WSL,(WSCUL(J),J=2,NN),
     *WSCUL(NWSCT)
  310 FORMAT(27X,'WIND SPEED (METERS/SECOND)'//
     *1X,'   DIRECTION *     ',18X,'ALL'//)
  311 FORMAT(26X,'WIND SPEED (METERS/SECOND)'//
     *1X,'   DIRECTION *     ',8X,'<',F4.1,7X,'> OR = ',F4.1,
     *9X,'TOTAL'//)
  312 FORMAT(34X,'WIND SPEED (METERS/SECOND)'//
     *4X,'DIRECTION *',13X,'<',F4.1,11X,'<',F4.1,8X,'> OR = ',
     *F4.1,7X,'TOTAL'//)
  313 FORMAT(42X,'WIND SPEED (METERS/SECOND)'//
     *4X,'DIRECTION *',13X,'<',F4.1,11X,2('<',F4.1,11X),
     *'> OR = ',F4.1,8X,'TOTAL'//)
  314 FORMAT(50X,'WIND SPEED (METERS/SECOND)'//
     *4X,'DIRECTION *',13X,'<',F4.1,11X,3('<',F4.1,11X),
     *'> OR = ',F4.1,8X,'TOTAL'//)
  315 FORMAT(58X,'WIND SPEED (METERS/SECOND)'//
     *4X,'DIRECTION *',13X,'<',F4.1,11X,4('<',F4.1,11X),
     *'> OR = ',F4.1,8X,'TOTAL'//)
       ITOT=IOBTOT
      IF(ITOT.EQ.0) ITOT=IOBTOT
      DO 500 J=2,37
      JJ=J
      IRTOT=0
      RTOT=0.0
      DO 320 K=1,NWSCT
      IF(IRPT.EQ.2) FIL(K)=FLOAT(IOB(JJ,K))/FLOAT(ITOT)
      IRTOT=IRTOT+IOB(JJ,K)
  320 CONTINUE
      IF(IRPT.EQ.2) RTOT=FLOAT(IRTOT)/FLOAT(ITOT)
      IF(IRPT.NE.1) GO TO 360
      IF(NWSCT.EQ.1) WRITE(6,351) IDIRL(J),(IOB(JJ,K),K=1,NWSCT)
      IF(NWSCT.EQ.2) WRITE(6,352) IDIRL(J),(IOB(JJ,K),K=1,NWSCT),IRTOT
      IF(NWSCT.EQ.3) WRITE(6,353) IDIRL(J),(IOB(JJ,K),K=1,NWSCT),IRTOT
      IF(NWSCT.EQ.4) WRITE(6,354) IDIRL(J),(IOB(JJ,K),K=1,NWSCT),IRTOT
      IF(NWSCT.EQ.5) WRITE(6,355) IDIRL(J),(IOB(JJ,K),K=1,NWSCT),IRTOT
      IF(NWSCT.EQ.6) WRITE(6,356) IDIRL(J),(IOB(JJ,K),K=1,NWSCT),IRTOT
  351 FORMAT(8X,I2,26X,I5)
  352 FORMAT(8X,I2,17X,2(I5,10X),2X,I5)
  353 FORMAT(8X,I2,17X,3(I5,11X),2X,I5)
  354 FORMAT(8X,I2,17X,4(I5,11X),2X,I5)
  355 FORMAT(8X,I2,17X,5(I5,11X),2X,I5)
  356 FORMAT(8X,I2,17X,6(I5,11X),2X,I5)
      GO TO 500
  360 CONTINUE
      IF(NWSCT.EQ.1) WRITE(6,361) IDIRL(J),(FIL(K),K=1,NWSCT)
      IF(NWSCT.EQ.2) WRITE(6,362) IDIRL(J),(FIL(K),K=1,NWSCT),RTOT
      IF(NWSCT.EQ.3) WRITE(6,363) IDIRL(J),(FIL(K),K=1,NWSCT),RTOT
      IF(NWSCT.EQ.4) WRITE(6,364) IDIRL(J),(FIL(K),K=1,NWSCT),RTOT
      IF(NWSCT.EQ.5) WRITE(6,365) IDIRL(J),(FIL(K),K=1,NWSCT),RTOT
      IF(NWSCT.EQ.6) WRITE(6,366) IDIRL(J),(FIL(K),K=1,NWSCT),RTOT
  361 FORMAT(7X,'> ',I2,25X,F7.6)
  362 FORMAT(8X,I2,16X,2(F7.6,7X),2X,F8.6)
  363 FORMAT(8X,I2,16X,3(F7.6,9X),F8.6)
  364 FORMAT(8X,I2,16X,4(F7.6,9X),F8.6)
  365 FORMAT(8X,I2,16X,5(F7.6,9X),F8.6)
  366 FORMAT(8X,I2,16X,6(F7.6,9X),F8.6)
      GO TO 500
  500 CONTINUE
      DO 520 K=1,NWSCT
      IFIL(K)=0
      FIL(K)=0.0
      DO 510 J=1,37
      IFIL(K)=IFIL(K)+IOB(J,K)
  510 CONTINUE
      IF(IRPT.EQ.2) FIL(K)=FLOAT(IFIL(K))/FLOAT(ITOT)
  520 CONTINUE
      IF(IRPT.EQ.2) GO TO 540
      IF(NWSCT.EQ.1) WRITE(6,531) (IFIL(K),K=1,NWSCT)
      IF(NWSCT.EQ.2) WRITE(6,532) (IFIL(K),K=1,NWSCT)
      IF(NWSCT.EQ.3) WRITE(6,533) (IFIL(K),K=1,NWSCT)
      IF(NWSCT.EQ.4) WRITE(6,534) (IFIL(K),K=1,NWSCT)
      IF(NWSCT.EQ.5) WRITE(6,535) (IFIL(K),K=1,NWSCT)
      IF(NWSCT.EQ.6) WRITE(6,536) (IFIL(K),K=1,NWSCT)
  531 FORMAT(11X,'TOTAL',20X,I5/)
  532 FORMAT(//1X,'TOTAL',22X,2(I5,10X),2X,I5/)
  533 FORMAT(//1X,'TOTAL',22X,3(I5,11X),I5/)
  534 FORMAT(//1X,'TOTAL',22X,4(I5,11X),I5/)
  535 FORMAT(//1X,'TOTAL',22X,5(I5,11X),I5/)
  536 FORMAT(//1X,'TOTAL',22X,6(I5,11X),I5/)
      GO TO 550
  540 CONTINUE
      IF(NWSCT.EQ.1) WRITE(6,541) (FIL(K),K=1,NWSCT)
      IF(NWSCT.EQ.2) WRITE(6,542) (FIL(K),K=1,NWSCT)
      IF(NWSCT.EQ.3) WRITE(6,543) (FIL(K),K=1,NWSCT)
      IF(NWSCT.EQ.4) WRITE(6,544) (FIL(K),K=1,NWSCT)
      IF(NWSCT.EQ.5) WRITE(6,545) (FIL(K),K=1,NWSCT)
      IF(NWSCT.EQ.6) WRITE(6,546) (FIL(K),K=1,NWSCT)
  541 FORMAT(//1X,'TOTAL',29X,F8.6/)
  542 FORMAT(//1X,'TOTAL',21X,2(F7.6,7X),2X,F8.6/)
  543 FORMAT(//1X,'TOTAL',20X,3(F8.6,8X),F8.6/)
  544 FORMAT(//1X,'TOTAL',20X,4(F8.6,8X),F8.6/)
  545 FORMAT(//1X,'TOTAL',20X,5(F8.6,8X),F8.6/)
  546 FORMAT(//1X,'TOTAL',20X,6(F8.6,8X),F8.6/)
      PERCLM = FLOAT(ICLM) / FLOAT(ITOT)
      WRITE(6,548) PERCLM
  548 FORMAT(/1X,'PERCENTAGE OF CALMS = ',F8.6)
      WRITE(6,549)
  549 FORMAT(/1X,'* NOTE - DIRECTION FROM WHICH THE WIND IS BLOWING')
  550 CONTINUE
      IF(IRPT.NE.1.AND.IRPT.NE.3) GO TO 590
      WRITE(6,580) ITOT
  580 FORMAT(/1X,'TOTAL NUMBER OF OBSERVATIONS = ',I5)
      WRITE(6,585) ICLM
  585 FORMAT(/1X,'TOTAL NUMBER OF CALMS = ',I5)
      WRITE(6,549)
  590 CONTINUE
      IF(IRPT.LE.2) GO TO 600
      WRITE(6,595)
  595 FORMAT(///1X,' **  OBSERVATIONS NOT FALLING INTO ANY'/6X,
     *'CATEGORY ARE NOT INCLUDED IN THE'/6X,
     *'FREQUENCY DISTRIBUTION CALCULATION.')
  600 CONTINUE
      IF(IRPT.GE.2)GOTO700
      IRPT=IRPT+1
      GOTO300
  700 CONTINUE
      WRITE(6,701)
  701 FORMAT(1H1,18X,'INPUT SUMMARY'//1X,
     *1X,'STATION NUMBER',5X,'YEAR',5X,'NUMBER OF RECORDS')
      WRITE(6,702) ISTA,IYR,NREC
  702 FORMAT(6X,I5,11X,I2,13X,I4)
  703 CONTINUE
      GO TO 999
  801 CONTINUE
      WRITE(6,805) ISTA,ISSI
  805 FORMAT(1H1,'STATION NUMBERS DO NOT MATCH'/1X,
     *'REQUESTED STATION NUMBER = ',I5/1X,
     *'STATION NUMBER ON MET FILE = ',I5)
      GO TO 999
  803 WRITE(6,809)IIWS,IDIR
  809 FORMAT(1H1,5X,'SPEED = ',I3,5X,'DIRECTION = ',I3/
     *1X,'BOTH DIRECTION AND SPEED MUST BE ZERO IF EITHER ARE'/
     *1X,'CHECK DATA')
      GOTO 999
  802 CONTINUE
      WRITE(6,806) IYR,JYR
  806 FORMAT(1H1,'YEAR DOES NOT MATCH'/1X,
     *'REQUESTED YEAR = ',I2,/1X,
     *'YEAR ON MET FILE = ',I2)
  807 WRITE(6,808)NWSCT
  808 FORMAT(1H1,5X,F10.0,' IS BAD VALUE FOR NO. OF SPEED CAT.')
  999 STOP
      END
